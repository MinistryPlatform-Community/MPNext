{"version":3,"file":"nw-embed.es.js","sources":["../src/shared/base-widget.ts","../src/shared/api-client.ts","../src/components/pledge.ts","../src/index.ts"],"sourcesContent":["/**\n * Base class for Northwoods embeddable widgets\n * Handles Shadow DOM, API communication, and token management\n */\nexport abstract class NorthwoodsWidget extends HTMLElement {\n  protected root: ShadowRoot;\n  protected apiHost: string;\n  protected tenantId: string;\n  protected tokenProvider: () => Promise<string>;\n\n  constructor() {\n    super();\n    this.root = this.attachShadow({ mode: \"open\" });\n\n    // Read config from <script> tag or element attributes\n    const scriptTag = document.querySelector<HTMLScriptElement>(\n      \"script[data-api-host]\"\n    );\n    this.apiHost =\n      this.getAttribute(\"api-host\") ||\n      scriptTag?.dataset.apiHost ||\n      \"https://northwoods.vercel.app\";\n    this.tenantId =\n      this.getAttribute(\"tenant\") || scriptTag?.dataset.tenant || \"\";\n\n    console.log(\"üîß Widget constructor - checking for token provider...\");\n    console.log(\"window.__nwTokenProvider exists?\", !!(window as any).__nwTokenProvider);\n    console.log(\"window.__nwTokenProvider.get exists?\", !!(window as any).__nwTokenProvider?.get);\n\n    // Token provider with refresh support\n    this.tokenProvider =\n      (window as any).__nwTokenProvider?.get ||\n      (async () => {\n        console.warn(\"‚ö†Ô∏è No token provider initialized. Call init() before using the widget.\");\n        return this.getAttribute(\"token\") || \"\";\n      });\n  }\n\n  /**\n   * Fetch wrapper with automatic token injection and refresh on 401\n   */\n  protected async fetch(path: string, init?: RequestInit): Promise<Response> {\n    // Wait for token provider to be ready (max 5 seconds)\n    await this.waitForTokenProvider();\n    \n    let token: string;\n    \n    try {\n      token = await this.tokenProvider();\n    } catch (error) {\n      console.error(\"‚ùå Error getting token from tokenProvider:\", error);\n      throw new Error(`Failed to get authentication token: ${error instanceof Error ? error.message : \"Unknown error\"}`);\n    }\n    \n    if (!token) {\n      console.error(\"‚ùå No token received from tokenProvider\");\n      console.error(\"Make sure you called init() with a tokenProvider before mounting the widget\");\n      throw new Error(\"Authentication token not available. Did you call init()?\");\n    }\n\n    console.log(\"üîë Token received:\", token.substring(0, 20) + \"...\");\n    \n    const headers: Record<string, string> = {\n      ...(init?.headers as Record<string, string>),\n      Authorization: `Bearer ${token}`,\n    };\n\n    if (this.tenantId) {\n      headers[\"X-Tenant-ID\"] = this.tenantId;\n    }\n\n    const res = await fetch(`${this.apiHost}${path}`, {\n      ...init,\n      headers,\n      credentials: \"omit\",\n      mode: \"cors\",\n    });\n\n    // Handle token refresh on 401\n    if (res.status === 401 && (window as any).__nwTokenProvider?.refresh) {\n      const newToken = await (window as any).__nwTokenProvider.refresh();\n      return fetch(`${this.apiHost}${path}`, {\n        ...init,\n        headers: {\n          ...(init?.headers as Record<string, string>),\n          Authorization: `Bearer ${newToken}`,\n          \"X-Tenant-ID\": this.tenantId,\n        },\n        credentials: \"omit\",\n        mode: \"cors\",\n      });\n    }\n\n    return res;\n  }\n\n  /**\n   * Inject CSS into Shadow DOM\n   * Uses Constructable Stylesheets when available, fallback to <style> tag\n   */\n  protected injectStyles(css: string): void {\n    if (\n      \"adoptedStyleSheets\" in Document.prototype &&\n      \"replace\" in CSSStyleSheet.prototype\n    ) {\n      try {\n        const sheet = new CSSStyleSheet();\n        sheet.replaceSync(css);\n        this.root.adoptedStyleSheets = [sheet];\n      } catch (e) {\n        // Fallback for older browsers\n        this.injectStyleTag(css);\n      }\n    } else {\n      this.injectStyleTag(css);\n    }\n  }\n\n  /**\n   * Fallback style injection via <style> tag\n   */\n  private injectStyleTag(css: string): void {\n    const style = document.createElement(\"style\");\n    style.textContent = css;\n    this.root.appendChild(style);\n  }\n\n  /**\n   * Wait for token provider to be initialized\n   */\n  private async waitForTokenProvider(): Promise<void> {\n    // Wait for SDK ready promise first (if it exists)\n    if ((window as any).__nwSDKReady) {\n      console.log(\"‚è≥ Waiting for SDK initialization...\");\n      await (window as any).__nwSDKReady;\n      console.log(\"‚úÖ SDK initialization complete\");\n    }\n\n    // Double-check token provider is available\n    const maxWaitTime = 5000; // 5 seconds\n    const checkInterval = 100; // Check every 100ms\n    const startTime = Date.now();\n\n    while (!(window as any).__nwTokenProvider) {\n      if (Date.now() - startTime > maxWaitTime) {\n        throw new Error(\"Token provider not initialized after 5 seconds. Make sure init() is called.\");\n      }\n      await new Promise(resolve => setTimeout(resolve, checkInterval));\n    }\n\n    // Update token provider reference\n    this.tokenProvider = (window as any).__nwTokenProvider.get;\n    console.log(\"‚úÖ Token provider ready\");\n  }\n\n  /**\n   * Emit custom event from widget\n   */\n  protected emit(eventName: string, detail?: any): void {\n    this.dispatchEvent(\n      new CustomEvent(eventName, {\n        detail,\n        bubbles: true,\n        composed: true,\n      })\n    );\n  }\n\n  /**\n   * Abstract method to be implemented by child widgets\n   */\n  abstract render(): void;\n\n  /**\n   * Lifecycle hook - called when element is added to DOM\n   */\n  abstract connectedCallback(): void;\n}\n\n/**\n * Global token provider interface\n */\ndeclare global {\n  interface Window {\n    __nwTokenProvider?: {\n      get: () => Promise<string>;\n      refresh?: () => Promise<string>;\n    };\n    __nwSDKReady?: Promise<void>;\n    __nwSDKReadyResolve?: () => void;\n  }\n}\n","/**\n * Centralized API client for widget communication\n */\n\nexport interface ApiClientConfig {\n  apiHost: string;\n  tenantId?: string;\n  getToken: () => Promise<string>;\n  onTokenRefresh?: (newToken: string) => void;\n}\n\nexport class ApiClient {\n  private config: ApiClientConfig;\n\n  constructor(config: ApiClientConfig) {\n    this.config = config;\n  }\n\n  async request<T>(\n    path: string,\n    options: RequestInit & { skipRetry?: boolean } = {}\n  ): Promise<T> {\n    const { skipRetry, ...init } = options;\n    const token = await this.config.getToken();\n\n    const headers: Record<string, string> = {\n      \"Content-Type\": \"application/json\",\n      ...(init.headers as Record<string, string>),\n      Authorization: `Bearer ${token}`,\n    };\n\n    if (this.config.tenantId) {\n      headers[\"X-Tenant-ID\"] = this.config.tenantId;\n    }\n\n    const response = await fetch(`${this.config.apiHost}${path}`, {\n      ...init,\n      headers,\n      credentials: \"omit\",\n      mode: \"cors\",\n    });\n\n    // Handle 401 with token refresh\n    if (response.status === 401 && !skipRetry && this.config.onTokenRefresh) {\n      const newToken = await this.refreshToken();\n      if (newToken) {\n        return this.request<T>(path, { ...options, skipRetry: true });\n      }\n    }\n\n    if (!response.ok) {\n      const error = await response.json().catch(() => ({\n        error: response.statusText,\n      }));\n      throw new Error(error.error || `Request failed: ${response.statusText}`);\n    }\n\n    return response.json();\n  }\n\n  async post<T>(path: string, data: any, init?: RequestInit): Promise<T> {\n    return this.request<T>(path, {\n      ...init,\n      method: \"POST\",\n      body: JSON.stringify(data),\n    });\n  }\n\n  async get<T>(path: string, init?: RequestInit): Promise<T> {\n    return this.request<T>(path, {\n      ...init,\n      method: \"GET\",\n    });\n  }\n\n  private async refreshToken(): Promise<string | null> {\n    // This would call the session endpoint to get a fresh token\n    // Implementation depends on your auth flow\n    return null;\n  }\n}\n","import { NorthwoodsWidget } from \"../shared/base-widget\";\n\ninterface PledgeState {\n  courageousGift: string;\n  consistentGift: string;\n  creativeGift: string;\n  total: string;\n  errors: Record<string, boolean>;\n  isSubmitting: boolean;\n  isSuccess: boolean;\n  errorMessage: string;\n}\n\ninterface FormData {\n  firstName: string;\n  lastName: string;\n  email: string;\n  phone: string;\n  address: string;\n  city: string;\n  state: string;\n  zipcode: string;\n  notes?: string;\n}\n\nexport class PledgeWidget extends NorthwoodsWidget {\n  private state: PledgeState = {\n    courageousGift: \"\",\n    consistentGift: \"\",\n    creativeGift: \"\",\n    total: \"0.00\",\n    errors: {},\n    isSubmitting: false,\n    isSuccess: false,\n    errorMessage: \"\",\n  };\n\n  private campaignId: number;\n\n  constructor() {\n    super();\n    this.campaignId = parseInt(this.getAttribute(\"campaign-id\") || \"115\");\n  }\n\n  connectedCallback() {\n    this.injectStyles(this.getStyles());\n    this.render();\n    this.attachEventListeners();\n  }\n\n  private inputHandler = (e: Event) => this.handleInput(e);\n  private submitHandler = (e: Event) => this.handleSubmit(e);\n\n  private attachEventListeners() {\n    // Remove existing listeners to prevent duplicates\n    this.root.removeEventListener(\"input\", this.inputHandler);\n    this.root.removeEventListener(\"submit\", this.submitHandler);\n    \n    // Add listeners\n    this.root.addEventListener(\"input\", this.inputHandler);\n    this.root.addEventListener(\"submit\", this.submitHandler);\n  }\n\n  private handleInput(e: Event) {\n    const target = e.target as HTMLInputElement;\n\n    if (\n      target.name === \"courageous_gift\" ||\n      target.name === \"consistent_gift\" ||\n      target.name === \"creative_gift\"\n    ) {\n      const formatted = this.formatCurrency(target.value);\n      target.value = formatted;\n\n      const previousCreativeGift = this.state.creativeGift;\n      \n      if (target.name === \"courageous_gift\") this.state.courageousGift = formatted;\n      if (target.name === \"consistent_gift\") this.state.consistentGift = formatted;\n      if (target.name === \"creative_gift\") this.state.creativeGift = formatted;\n\n      this.updateTotal();\n      \n      // Toggle notes section visibility when creative gift changes\n      if (target.name === \"creative_gift\") {\n        this.toggleNotesSection(formatted);\n      }\n    }\n\n    if (target.name === \"phone\") {\n      const formatted = this.formatPhoneNumber(target.value);\n      target.value = formatted;\n    }\n  }\n\n  private formatCurrency(value: string): string {\n    const numericValue = value.replace(/[^0-9.]/g, \"\");\n    const parts = numericValue.split(\".\");\n    if (parts.length > 2) return value;\n\n    const decimalPart = parts[1];\n    if (decimalPart !== undefined && decimalPart.length > 2) return value;\n\n    return numericValue;\n  }\n\n  private parseNumeric(value: string): number {\n    const numeric = value.replace(/[^0-9.]/g, \"\");\n    return parseFloat(numeric) || 0;\n  }\n\n  private formatPhoneNumber(value: string): string {\n    const numeric = value.replace(/\\D/g, \"\");\n    const limited = numeric.substring(0, 10);\n\n    if (limited.length <= 3) {\n      return limited;\n    } else if (limited.length <= 6) {\n      return `${limited.slice(0, 3)}-${limited.slice(3)}`;\n    } else {\n      return `${limited.slice(0, 3)}-${limited.slice(3, 6)}-${limited.slice(6)}`;\n    }\n  }\n\n  private updateErrorStates() {\n    // Update error classes on inputs without re-rendering the whole form\n    const inputs = this.root.querySelectorAll<HTMLInputElement | HTMLTextAreaElement>('input, select, textarea');\n    \n    inputs.forEach(input => {\n      const fieldName = input.name;\n      if (this.state.errors[fieldName]) {\n        input.classList.add('error');\n      } else {\n        input.classList.remove('error');\n      }\n    });\n  }\n\n  private toggleNotesSection(creativeGiftValue: string) {\n    const notesSection = this.root.querySelector('.notes-section') as HTMLElement;\n    if (!notesSection) return;\n    \n    const isEmpty = !creativeGiftValue || creativeGiftValue === \"\" || creativeGiftValue === \"0\" || creativeGiftValue === \"0.00\";\n    notesSection.style.display = isEmpty ? 'none' : 'block';\n  }\n\n  private updateTotal() {\n    const a = this.parseNumeric(this.state.courageousGift);\n    const b = this.parseNumeric(this.state.consistentGift);\n    const c = this.parseNumeric(this.state.creativeGift);\n    const sum = a + b + c;\n    this.state.total = sum.toFixed(2);\n    \n    const totalInput = this.root.querySelector<HTMLInputElement>('input[name=\"total_gift\"]');\n    if (totalInput) {\n      const formatted = parseFloat(this.state.total).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n      totalInput.value = `$${formatted}`;\n    }\n  }\n\n  private validateEmail(email: string): boolean {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return emailRegex.test(email);\n  }\n\n  private validatePhone(phone: string): boolean {\n    const numericPhone = phone.replace(/\\D/g, \"\");\n    return numericPhone.length === 10;\n  }\n\n  private async handleSubmit(e: Event) {\n    e.preventDefault();\n    \n    // Prevent duplicate submissions\n    if (this.state.isSubmitting) {\n      return;\n    }\n    \n    const form = e.target as HTMLFormElement;\n    const formData = new FormData(form);\n\n    const data: FormData = {\n      firstName: formData.get(\"firstName\") as string,\n      lastName: formData.get(\"lastName\") as string,\n      email: formData.get(\"email\") as string,\n      phone: formData.get(\"phone\") as string,\n      address: formData.get(\"address\") as string,\n      city: formData.get(\"city\") as string,\n      state: formData.get(\"state\") as string,\n      zipcode: formData.get(\"zipcode\") as string,\n      notes: formData.get(\"notes\") as string || undefined,\n    };\n\n    const newErrors: Record<string, boolean> = {};\n\n    if (!data.firstName?.trim()) newErrors.firstName = true;\n    if (!data.lastName?.trim()) newErrors.lastName = true;\n    if (!data.email?.trim() || !this.validateEmail(data.email)) newErrors.email = true;\n    if (!data.phone?.trim() || !this.validatePhone(data.phone)) newErrors.phone = true;\n    if (!data.address?.trim()) newErrors.address = true;\n    if (!data.city?.trim()) newErrors.city = true;\n    if (!data.zipcode?.trim() || data.zipcode.length !== 5) newErrors.zipcode = true;\n\n    const a = this.parseNumeric(this.state.courageousGift);\n    const b = this.parseNumeric(this.state.consistentGift);\n    const c = this.parseNumeric(this.state.creativeGift);\n\n    if (a === 0 && b === 0 && c === 0) {\n      newErrors.courageous_gift = true;\n      newErrors.consistent_gift = true;\n      newErrors.creative_gift = true;\n    }\n\n    this.state.errors = newErrors;\n\n    if (Object.keys(newErrors).length > 0) {\n      // Update error states without re-rendering entire form\n      this.updateErrorStates();\n      return;\n    }\n\n    this.state.isSubmitting = true;\n    this.state.errorMessage = \"\";\n    this.render();\n\n    try {\n      const idempotencyKey = crypto.randomUUID();\n\n      const apiUrl = this.apiHost || \"http://localhost:3000\";\n      const response = await this.fetch(`/api/embed/pledge/submit`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Idempotency-Key\": idempotencyKey,\n        },\n        body: JSON.stringify({\n          campaignId: this.campaignId,\n          firstName: data.firstName,\n          lastName: data.lastName,\n          email: data.email,\n          phone: data.phone,\n          address: data.address,\n          city: data.city,\n          state: data.state,\n          zipcode: data.zipcode,\n          courageous_gift: this.state.courageousGift,\n          consistent_gift: this.state.consistentGift,\n          creative_gift: this.state.creativeGift,\n          total_gift: this.state.total,\n          notes: data.notes,\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({ error: \"Unknown error\" }));\n        throw new Error(errorData.error || `HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      const result = await response.json();\n\n      if (result.success) {\n        this.state.isSuccess = true;\n        window.scrollTo({ top: 0, behavior: 'smooth' });\n        this.emit(\"pledgeSubmitted\", {\n          pledgeId: result.pledgeId,\n          total: this.state.total,\n        });\n      } else {\n        this.state.errorMessage = result.error || \"Failed to save pledge. Please try again.\";\n        this.emit(\"pledgeError\", { error: this.state.errorMessage });\n      }\n    } catch (error: any) {\n      this.state.errorMessage = error.message || \"Failed to save pledge. Please try again.\";\n      this.emit(\"pledgeError\", { error: this.state.errorMessage });\n    } finally {\n      this.state.isSubmitting = false;\n      this.render();\n    }\n  }\n\n  render() {\n    if (this.state.isSuccess) {\n      this.root.innerHTML = this.renderSuccess();\n    } else {\n      this.root.innerHTML = this.renderForm();\n    }\n    this.attachEventListeners();\n  }\n\n  private renderSuccess(): string {\n    const totalFormatted = parseFloat(this.state.total).toLocaleString(\"en-US\", {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    });\n\n    return `\n      <div class=\"nw-pledge\">\n        <div class=\"pledge-header success-header\">\n          <div class=\"success-title\">Thank You!</div>\n          <p class=\"success-message\">\n            Thank you for your commitment to the Now is the Time campaign.\n          </p>\n        </div>\n        <div class=\"pledge-success-content\">\n          <div class=\"total-commitment\">\n            <div class=\"commitment-label\">Total Commitment</div>\n            <div class=\"commitment-amount\">$${totalFormatted}</div>\n          </div>\n          <div class=\"success-text\">\n            <p>Your commitment has been recorded successfully.</p>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderForm(): string {\n    const { errors, isSubmitting, errorMessage } = this.state;\n    \n    return `\n      <form class=\"nw-pledge\" novalidate>\n        <div class=\"pledge-header\">\n          <div class=\"pledge-title\">MY COMMITMENT</div>\n          \n          <div class=\"form-row\">\n            <div class=\"form-field\">\n              <label for=\"firstName\">FIRST NAME</label>\n              <input type=\"text\" id=\"firstName\" name=\"firstName\" required \n                class=\"${errors.firstName ? 'error' : ''}\" ${isSubmitting ? 'disabled' : ''}>\n            </div>\n            <div class=\"form-field\">\n              <label for=\"lastName\">LAST NAME</label>\n              <input type=\"text\" id=\"lastName\" name=\"lastName\" required \n                class=\"${errors.lastName ? 'error' : ''}\" ${isSubmitting ? 'disabled' : ''}>\n            </div>\n          </div>\n\n          <div class=\"form-field\">\n            <label for=\"email\">EMAIL</label>\n            <input type=\"email\" id=\"email\" name=\"email\" required \n              class=\"${errors.email ? 'error' : ''}\" ${isSubmitting ? 'disabled' : ''}>\n          </div>\n\n          <div class=\"form-field\">\n            <label for=\"phone\">PHONE</label>\n            <input type=\"tel\" id=\"phone\" name=\"phone\" required placeholder=\"555-555-5555\"\n              class=\"${errors.phone ? 'error' : ''}\" ${isSubmitting ? 'disabled' : ''}>\n          </div>\n\n          <div class=\"form-field\">\n            <label for=\"address\">ADDRESS</label>\n            <input type=\"text\" id=\"address\" name=\"address\" required \n              class=\"${errors.address ? 'error' : ''}\" ${isSubmitting ? 'disabled' : ''}>\n          </div>\n\n          <div class=\"form-row form-row-3\">\n            <div class=\"form-field\">\n              <label for=\"city\">CITY</label>\n              <input type=\"text\" id=\"city\" name=\"city\" required \n                class=\"${errors.city ? 'error' : ''}\" ${isSubmitting ? 'disabled' : ''}>\n            </div>\n            <div class=\"form-field\">\n              <label for=\"state\">STATE</label>\n              <select id=\"state\" name=\"state\" ${isSubmitting ? 'disabled' : ''}>\n                ${this.renderStateOptions()}\n              </select>\n            </div>\n            <div class=\"form-field\">\n              <label for=\"zipcode\">ZIPCODE</label>\n              <input type=\"text\" id=\"zipcode\" name=\"zipcode\" required maxlength=\"5\" pattern=\"[0-9]{5}\" placeholder=\"12345\"\n                class=\"${errors.zipcode ? 'error' : ''}\" ${isSubmitting ? 'disabled' : ''}>\n            </div>\n          </div>\n\n          <div class=\"commitment-header\">WITH DEPENDENCE ON GOD I/WE COMMIT TO:</div>\n        </div>\n\n        <div class=\"pledge-body\">\n\n          <div class=\"gift-section\">\n            <div class=\"gift-row\">\n              <div class=\"gift-label\">COURAGEOUS GIFT</div>\n              <div class=\"gift-input-wrapper\">\n                <span class=\"currency-symbol\">$</span>\n                <input type=\"text\" name=\"courageous_gift\" placeholder=\"0.00\" \n                  class=\"${errors.courageous_gift ? 'error' : ''}\" ${isSubmitting ? 'disabled' : ''}>\n              </div>\n            </div>\n            <div class=\"gift-description\">\n              Given on or before Commitment Sunday on Nov. 9. If using a check, make it payable to \"Northwoods\" with a memo of \"Now is the Time\".\n            </div>\n          </div>\n\n          <div class=\"gift-section\">\n            <div class=\"gift-row\">\n              <div class=\"gift-label\">CONSISTENT GIFT</div>\n              <div class=\"gift-input-wrapper\">\n                <span class=\"currency-symbol\">$</span>\n                <input type=\"text\" name=\"consistent_gift\" placeholder=\"0.00\" \n                  class=\"${errors.consistent_gift ? 'error' : ''}\" ${isSubmitting ? 'disabled' : ''}>\n              </div>\n            </div>\n            <div class=\"gift-description\">\n              In addition to your Courageous Gift, the total over the next 25 months from Dec. 1, 2025 to Dec. 31, 2027.\n            </div>\n          </div>\n\n          <div class=\"gift-section\">\n            <div class=\"gift-row\">\n              <div class=\"gift-label\">CREATIVE GIFT</div>\n              <div class=\"gift-input-wrapper\">\n                <span class=\"currency-symbol\">$</span>\n                <input type=\"text\" name=\"creative_gift\" placeholder=\"0.00\" \n                  class=\"${errors.creative_gift ? 'error' : ''}\" ${isSubmitting ? 'disabled' : ''}>\n              </div>\n            </div>\n            <div class=\"gift-description\">\n              Provide an estimated value of stocks, bonds or other assets.\n            </div>\n            <div class=\"notes-section\" style=\"display: ${this.state.creativeGift && this.state.creativeGift !== \"\" && this.state.creativeGift !== \"0\" && this.state.creativeGift !== \"0.00\" ? 'block' : 'none'}\">\n              <label for=\"notes\">Describe the creative gift(s).</label>\n              <textarea id=\"notes\" name=\"notes\" rows=\"3\" ${isSubmitting ? 'disabled' : ''}></textarea>\n            </div>\n          </div>\n\n          <div class=\"total-section\">\n            <div class=\"total-label\">TOTAL GIFT</div>\n            <div class=\"total-input-wrapper\">\n              <input type=\"text\" name=\"total_gift\" value=\"$${parseFloat(this.state.total).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\" readonly class=\"total-amount\">\n            </div>\n          </div>\n        </div>\n\n        <div class=\"pledge-footer\">\n          ${errorMessage ? `\n            <div class=\"error-message\">${errorMessage}</div>\n          ` : ''}\n          <button type=\"submit\" ${isSubmitting ? 'disabled' : ''}>\n            ${isSubmitting ? 'Saving...' : 'MAKE MY PLEDGE'}\n          </button>\n        </div>\n      </form>\n    `;\n  }\n\n  private renderStateOptions(): string {\n    const states = [\n      \"AL\", \"AK\", \"AZ\", \"AR\", \"CA\", \"CO\", \"CT\", \"DE\", \"FL\", \"GA\",\n      \"HI\", \"ID\", \"IL\", \"IN\", \"IA\", \"KS\", \"KY\", \"LA\", \"ME\", \"MD\",\n      \"MA\", \"MI\", \"MN\", \"MS\", \"MO\", \"MT\", \"NE\", \"NV\", \"NH\", \"NJ\",\n      \"NM\", \"NY\", \"NC\", \"ND\", \"OH\", \"OK\", \"OR\", \"PA\", \"RI\", \"SC\",\n      \"SD\", \"TN\", \"TX\", \"UT\", \"VT\", \"VA\", \"WA\", \"WV\", \"WI\", \"WY\"\n    ];\n    return states.map(state => \n      `<option value=\"${state}\" ${state === \"IL\" ? \"selected\" : \"\"}>${state}</option>`\n    ).join(\"\");\n  }\n\n  private getStyles(): string {\n    return `\n      :host {\n        all: initial;\n        display: block;\n        font-family: ui-sans-serif, system-ui, -apple-system, sans-serif;\n      }\n\n      .nw-pledge {\n        max-width: 600px;\n        margin: 0 auto;\n        background: white;\n        border-radius: 16px;\n        overflow: hidden;\n        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n      }\n\n      .pledge-header {\n        background: #002855;\n        color: white;\n        padding: 40px 32px;\n      }\n\n      .success-header {\n        text-align: center;\n      }\n\n      .pledge-title, .success-title {\n        font-size: 28px;\n        font-weight: bold;\n        text-align: center;\n        margin-bottom: 32px;\n      }\n\n      .success-title {\n        font-size: 36px;\n        margin-bottom: 24px;\n      }\n\n      .success-message {\n        font-size: 18px;\n        line-height: 1.6;\n        margin: 0;\n      }\n\n      .pledge-success-content {\n        padding: 40px 32px;\n        text-align: center;\n      }\n\n      .total-commitment {\n        margin-bottom: 24px;\n      }\n\n      .commitment-label {\n        font-size: 12px;\n        color: #6b7280;\n        text-transform: uppercase;\n        letter-spacing: 0.05em;\n        margin-bottom: 8px;\n      }\n\n      .commitment-amount {\n        font-size: 48px;\n        font-weight: bold;\n        color: #002855;\n      }\n\n      .success-text {\n        color: #374151;\n        line-height: 1.6;\n      }\n\n      .form-field {\n        margin-bottom: 16px;\n      }\n\n      .form-row {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 12px;\n        margin-bottom: 16px;\n      }\n\n      .form-row-3 {\n        grid-template-columns: 2fr 1fr 1fr;\n      }\n\n      label {\n        display: block;\n        font-size: 12px;\n        color: #d1d5db;\n        text-transform: uppercase;\n        letter-spacing: 0.05em;\n        margin-bottom: 6px;\n      }\n\n      input, select, textarea {\n        width: 100%;\n        padding: 12px 16px;\n        border: 1px solid #d1d5db;\n        border-radius: 8px;\n        font-size: 14px;\n        color: #1f2937;\n        background: white;\n        box-sizing: border-box;\n      }\n\n      select {\n        appearance: none;\n        -webkit-appearance: none;\n        -moz-appearance: none;\n        background-image: url(\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\");\n        background-repeat: no-repeat;\n        background-position: right 0.5rem center;\n        background-size: 1.5em 1.5em;\n        padding-right: 2.5rem;\n      }\n\n      input:focus, select:focus, textarea:focus {\n        outline: none;\n        background: #f9fafb;\n        border-color: #004C97;\n      }\n\n      input.error, select.error, textarea.error {\n        border: 2px solid #FF6D6A;\n      }\n\n      input:disabled, select:disabled, textarea:disabled, button:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n\n      .pledge-body {\n        padding: 32px;\n      }\n\n      .commitment-header {\n        color: white;\n        padding: 12px 20px;\n        margin-bottom: 0;\n        font-size: 18px;\n        font-weight: bold;\n        text-align: center;\n      }\n\n      .gift-section {\n        margin-bottom: 32px;\n      }\n\n      .gift-row {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 16px;\n        align-items: center;\n        margin-bottom: 12px;\n      }\n\n      .gift-label {\n        font-size: 16px;\n        font-weight: bold;\n        color: #002855;\n      }\n\n      .gift-input-wrapper {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .currency-symbol {\n        color: #6b7280;\n        font-size: 16px;\n      }\n\n      .gift-input-wrapper input {\n        flex: 1;\n      }\n\n      .gift-description {\n        font-size: 13px;\n        color: #374151;\n        font-style: italic;\n        line-height: 1.5;\n        padding-left: calc(50% + 8px);\n      }\n\n      .notes-section {\n        margin-top: 16px;\n      }\n\n      .notes-section label {\n        color: #6b7280;\n        font-size: 12px;\n        text-transform: none;\n        margin-bottom: 8px;\n      }\n\n      .total-section {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 16px;\n        align-items: center;\n        margin-top: 32px;\n        padding-top: 32px;\n        border-top: 2px solid #e5e7eb;\n      }\n\n      .total-label {\n        font-size: 18px;\n        font-weight: bold;\n        color: #002855;\n        text-align: center;\n      }\n\n      .total-input-wrapper {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .total-amount {\n        font-size: 20px;\n        font-weight: bold;\n        color: #002855;\n        border: none !important;\n        background: transparent !important;\n        padding-left: 0 !important;\n        text-align: center;\n      }\n\n      .pledge-footer {\n        background: #002855;\n        padding: 32px;\n        text-align: center;\n      }\n\n      .error-message {\n        background: #fee;\n        color: #c00;\n        padding: 12px 16px;\n        border-radius: 8px;\n        margin-bottom: 16px;\n        text-align: center;\n      }\n\n      button[type=\"submit\"] {\n        padding: 12px 32px;\n        background: white;\n        color: #002855;\n        font-weight: bold;\n        font-size: 16px;\n        border: none;\n        border-radius: 8px;\n        cursor: pointer;\n        transition: background 0.2s;\n      }\n\n      button[type=\"submit\"]:hover:not(:disabled) {\n        background: #f3f4f6;\n      }\n\n      @media (max-width: 640px) {\n        .form-row, .gift-row, .total-section {\n          grid-template-columns: 1fr;\n        }\n\n        .form-row-3 {\n          grid-template-columns: 1fr;\n        }\n\n        .gift-description {\n          padding-left: 24px;\n        }\n\n        .pledge-header, .pledge-body, .pledge-footer {\n          padding: 24px;\n        }\n      }\n\n      @media (min-width: 641px) {\n        .total-label {\n          text-align: left;\n        }\n\n        .total-input-wrapper {\n          justify-content: flex-start;\n        }\n\n        .total-amount {\n          text-align: left;\n        }\n      }\n    `;\n  }\n}\n\ncustomElements.define(\"nw-pledge\", PledgeWidget);\n","/**\n * Northwoods Embed SDK\n * Web components for embedding Northwoods widgets\n */\n\nexport { NorthwoodsWidget } from \"./shared/base-widget\";\nexport { ApiClient } from \"./shared/api-client\";\nexport { PledgeWidget } from \"./components/pledge\";\n\n// Auto-register components\nimport \"./components/pledge\";\n\n// Global ready promise that resolves when SDK is initialized\nif (typeof window !== \"undefined\") {\n  let readyResolve: (() => void) | null = null;\n  (window as any).__nwSDKReady = new Promise<void>((resolve) => {\n    readyResolve = resolve;\n  });\n  (window as any).__nwSDKReadyResolve = readyResolve;\n}\n\n/**\n * Initialize the SDK with token provider\n */\nexport function init(config: {\n  tokenProvider: {\n    get: () => Promise<string>;\n    refresh?: () => Promise<string>;\n  };\n}): void {\n  console.log(\"‚úÖ Northwoods SDK initialized with token provider\");\n  \n  if (typeof window !== \"undefined\") {\n    (window as any).__nwTokenProvider = config.tokenProvider;\n    console.log(\"‚úÖ Token provider set on window.__nwTokenProvider\");\n    \n    // Resolve ready promise\n    if ((window as any).__nwSDKReadyResolve) {\n      (window as any).__nwSDKReadyResolve();\n      console.log(\"‚úÖ SDK ready promise resolved\");\n    }\n  }\n  \n  // Test the token provider immediately\n  config.tokenProvider.get()\n    .then(token => {\n      if (token) {\n        console.log(\"‚úÖ Token provider test successful, token length:\", token.length);\n      } else {\n        console.error(\"‚ùå Token provider returned empty token\");\n      }\n    })\n    .catch(error => {\n      console.error(\"‚ùå Token provider test failed:\", error);\n    });\n}\n\n/**\n * Set token provider globally (alternative to init)\n */\nif (typeof window !== \"undefined\") {\n  (window as any).NorthwoodsEmbed = {\n    init,\n    setTokenProvider: (provider: { get: () => Promise<string>; refresh?: () => Promise<string> }) => {\n      (window as any).__nwTokenProvider = provider;\n    }\n  };\n}\n\n// Export global types\ndeclare global {\n  interface Window {\n    __nwTokenProvider?: {\n      get: () => Promise<string>;\n      refresh?: () => Promise<string>;\n    };\n    __nwSDKReady?: Promise<void>;\n    __nwSDKReadyResolve?: () => void;\n  }\n}\n"],"names":["NorthwoodsWidget","_a","_b","scriptTag","path","init","token","error","headers","res","newToken","css","sheet","style","maxWaitTime","checkInterval","startTime","resolve","eventName","detail","ApiClient","config","options","skipRetry","response","data","PledgeWidget","e","target","formatted","value","numericValue","parts","decimalPart","numeric","limited","input","fieldName","creativeGiftValue","notesSection","isEmpty","a","b","c","sum","totalInput","email","phone","_c","_d","_e","_f","_g","form","formData","newErrors","idempotencyKey","apiUrl","errorData","result","errors","isSubmitting","errorMessage","state","readyResolve","provider"],"mappings":"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"}